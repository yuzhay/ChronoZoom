var CZ;(function(n){(function(t){(function(t){function i(n,t){var i=$("<div><\/div>",{"class":"cz-authoring-ci-container"}),u=$("<p><\/p>").append($("<label><\/label>",{text:"Title"})).append($("<input><\/input>",{"class":"cz-authoring-ci-title",style:"display: block;",type:"text"})),f=$("<p><\/p>").append($("<label><\/label>",{style:"display: block;",text:"Description"})).append($("<textarea><\/textarea>",{"class":"cz-authoring-ci-description",style:"display: block;"})),e=$("<p><\/p>").append($("<label><\/label>",{text:"URL of image or video"})).append($("<input><\/input>",{"class":"cz-authoring-ci-uri",style:"display: block;",type:"text"})),o=$("<p><\/p>").append($("<label><\/label>",{text:"Media type"})).append($("<select><\/select>",{"class":"cz-authoring-ci-media-type",style:"display: block;"}).append($("<option><\/option>",{value:"image",text:"Image"}),$("<option><\/option>",{value:"pdf",text:"PDF"}),$("<option><\/option>",{value:"video",text:"Video"}),$("<option><\/option>",{value:"audio",text:"Audio"}))),s=$("<p><\/p>").append($("<label><\/label>",{text:"Attribution"})).append($("<input><\/input>",{"class":"cz-authoring-ci-attribution",style:"display: block;",type:"text"})),h=$("<p><\/p>").append($("<label><\/label>",{text:"Media Source"})).append($("<input><\/input>",{"class":"cz-authoring-ci-media-source",style:"display: block;",type:"text"})),c=$("<button><\/button>",{text:"Remove content item",click:function(){i.remove()}}),r;i.append(u),i.append(f),i.append(e),i.append(o),i.append(s),i.append(h),i.append(c),t==!0&&(r=$("<hr />"),i.append(r)),n.append(i)}function r(){var n=[],t=$(".cz-authoring-ci-container");return $(".cz-authoring-ci-container").each(function(){for(var u=$(this).find(".cz-authoring-ci-title"),f=$(this).find(".cz-authoring-ci-uri"),i=$(this).find(".cz-authoring-ci-media-type option"),e=$(this).find(".cz-authoring-ci-description"),o=$(this).attr("cz-authoring-ci-guid")||undefined,s=$(this).find(".cz-authoring-ci-attribution"),h=$(this).find(".cz-authoring-ci-media-source"),r=$(i)[0],t=0;t<i.length;t++)if(i[t].selected){r=i[t];break}n.push({title:u.val(),description:e.val(),uri:f.val(),mediaType:r.text,attribution:s.val(),mediaSource:h.val(),guid:o,parent:undefined})}),n}function u(n,t){var r=n.find(".cz-authoring-ci-title"),u=n.find(".cz-authoring-ci-uri"),f=n.find(".cz-authoring-ci-media-type option"),e=n.find(".cz-authoring-ci-description"),o=n.find(".cz-authoring-ci-attribution"),s=n.find(".cz-authoring-ci-media-source"),i=t.mediaType.toLowerCase();i==="picture"&&(i="image"),n.attr("cz-authoring-ci-guid",t.guid),r.val(t.title),u.val(t.uri),e.val(t.description),o.val(t.attribution),s.val(t.mediaSource),f.each(function(){if(this.value===i){$(this).attr("selected","selected");return}})}function f(t){var f=!0,u=$("#timelineTitleInput"),r=new n.UI.DatePicker($("#timelineStartInput")),i=new n.UI.DatePicker($("#timelineEndInput"));i.addEditMode_Infinite(),u.val(t.title),r.setDate(t.x),i.setDate(t.x+t.width),$("#createTimelineForm").dialog({title:"create timeline",modal:!0,height:600,width:600,buttons:{"save and close":function(){var e=n.Authoring.ValidateTimelineData(r.getDate(),i.getDate(),u.val()),o;e||$("#TimelineErrorSpan").css("display","block"),e&&(o=this,f=!1,n.Authoring.updateTimeline(t,{title:u.val(),start:r.getDate(),end:i.getDate()}).then(function(){$(o).dialog("close")},function(n){alert("Unable to save changes. Please try again later."),console.log(n)}))}},close:function(){f&&n.Authoring.removeTimeline(t),n.Authoring.isActive=!1,r.remove(),i.remove(),$("#TimelineErrorSpan").css("display","none"),$("a:contains('create timeline')").removeClass("active")}})}function e(t){var u=$("#timelineTitleInput"),r=new n.UI.DatePicker($("#timelineStartInput")),i=new n.UI.DatePicker($("#timelineEndInput"));i.addEditMode_Infinite(),u.val(t.title),r.setDate(t.x),i.setDate(t.x+t.width),$("#createTimelineForm").dialog({title:"edit timeline",modal:!0,height:600,width:600,buttons:{"save and close":function(){var f=n.Authoring.ValidateTimelineData(r.getDate(),i.getDate(),u.val()),e;f||$("#TimelineErrorSpan").css("display","block"),f&&(e=this,n.Authoring.updateTimeline(t,{title:u.val(),start:r.getDate(),end:i.getDate()}).then(function(){$(e).dialog("close")},function(n){alert("Unable to save changes. Please try again later."),console.log(n)}))},"delete":function(){confirm("Are you sure want to delete timeline and all of its nested timelines and exhibits? Delete can't be undone!")&&(n.Authoring.removeTimeline(t),$(this).dialog("close"))}},close:function(){n.Authoring.isActive=!1,r.remove(),i.remove(),$("a:contains('edit timeline')").removeClass("active"),$("#TimelineErrorSpan").css("display","none")}})}function o(t){var h=!0,e=$("#exhibitTitleInput"),f=new n.UI.DatePicker($("#exhibitDateInput")),o,s;for(e.val(t.title),f.setDate(t.infodotDescription.date),o=t.contentItems,s=0;s<o.length;s++)i($("#createExhibitForm"),!0);$(".cz-authoring-ci-container").each(function(n){u($(this),o[n])}),$("#createExhibitForm").dialog({title:"create exhibit",modal:!0,height:600,width:600,buttons:{"save and close":function(){var i=r(),u=n.Authoring.ValidateExhibitData(f.getDate(),e.val(),i);u?(n.Authoring.updateExhibit(t,{title:e.val(),date:f.getDate(),contentItems:i}),h=!1,$(this).dialog("close")):$("#ExhibitErrorSpan").css("display","block")},"add content item":function(){$(this).find(".cz-authoring-ci-container").length<n.Settings.infodotMaxContentItemsCount&&i($(this),!0)}},close:function(){h&&n.Authoring.removeExhibit(t),n.Authoring.isActive=!1,f.remove(),$("a:contains('create exhibit')").removeClass("active"),$("#ExhibitErrorSpan").css("display","none"),$(this).find(".cz-authoring-ci-container").each(function(){$(this).remove()})}})}function s(t){var o=$("#exhibitTitleInput"),e=new n.UI.DatePicker($("#exhibitDateInput")),f,s;for(o.val(t.title),e.setDate(t.infodotDescription.date),f=t.contentItems,s=0;s<f.length;s++)i($("#createExhibitForm"),!0);$(".cz-authoring-ci-container").each(function(n){u($(this),f[n])}),$("#createExhibitForm").dialog({title:"edit exhibit",modal:!0,height:600,width:600,buttons:{"save and close":function(){f=r();var i=n.Authoring.ValidateExhibitData(e.getDate(),o.val(),f);i?(n.Authoring.updateExhibit(t,{title:o.val(),date:e.getDate(),contentItems:f}),$(this).dialog("close"),$(this).find(".cz-authoring-ci-container").each(function(){$(this).remove()})):$("#ExhibitErrorSpan").css("display","block")},"delete":function(){confirm("Are you sure want to delete exhibit and all of its content items? Delete can't be undone!")&&(n.Authoring.removeExhibit(t),$(this).dialog("close"))},"add content item":function(){$(this).find(".cz-authoring-ci-container").length<n.Settings.infodotMaxContentItemsCount&&i($("#createExhibitForm"),!0)}},close:function(){n.Authoring.isActive=!1,e.remove(),$("a:contains('edit exhibit')").removeClass("active"),$("#ExhibitErrorSpan").css("display","none"),$(this).find(".cz-authoring-ci-container").each(function(){$(this).remove()})}})}function h(t){var u=$("#contentItemTitleInput"),f=$("#contentItemMediaSourceInput"),e=$("#contentItemDescriptionInput"),i=$("#contentItemMediaTypeInput option"),o=$("#cz-authoring-ci-attribution"),s=$("#cz-authoring-ci-media-source"),r=t.contentItem.mediaType.toLowerCase();r==="picture"&&(r="image"),u.val(t.contentItem.title),f.val(t.contentItem.uri),e.val(t.contentItem.description),o.val(t.contentItem.attribution),s.val(t.contentItem.mediaSource),i.each(function(){if(this.value===r){$(this).attr("selected","selected");return}}),$("#editContentItemForm").dialog({title:"Edit content item",modal:!0,height:600,width:600,buttons:{"save and close":function(){for(var h=i[0],r=1;r<i.length;r++)i[r].selected&&(h=i[r]);n.Authoring.updateContentItem(t,{title:u.val(),uri:f.val(),mediaType:h.text,description:e.val(),attribution:o.val(),mediaSource:s.val()}),$(this).dialog("close")},"delete":function(){confirm("Are you sure want to delete content item? Delete can't be undone!")&&(n.Authoring.removeContentItem(t),$(this).dialog("close"))}},close:function(){n.Authoring.isActive=!1,$("a:contains('edit exhibit')").removeClass("active")}})}function c(){n.Layout.animatingElements.length==0&&(n.Authoring.isActive=n.Authoring.mode!=="createTimeline"||!n.Authoring.isActive,n.Authoring.mode="createTimeline",$("div #footer-authoring > a").removeClass("active"),n.Authoring.isActive?$("a:contains('create timeline')").addClass("active"):$("a:contains('create timeline')").removeClass("active"))}function l(){n.Layout.animatingElements.length==0&&(n.Authoring.isActive=n.Authoring.mode!=="editTimeline"||!n.Authoring.isActive,n.Authoring.mode="editTimeline",$("div #footer-authoring > a").removeClass("active"),n.Authoring.isActive?$("a:contains('edit timeline')").addClass("active"):$("a:contains('edit timeline')").removeClass("active"))}function a(){n.Layout.animatingElements.length==0&&(n.Authoring.isActive=n.Authoring.mode!=="createExhibit"||!n.Authoring.isActive,n.Authoring.mode="createExhibit",$("div #footer-authoring > a").removeClass("active"),n.Authoring.isActive?$("a:contains('create exhibit')").addClass("active"):$("a:contains('create exhibit')").removeClass("active"))}function v(){n.Layout.animatingElements.length==0&&(n.Authoring.isActive=n.Authoring.mode!=="editExhibit"||!n.Authoring.isActive,n.Authoring.mode="editExhibit",$("div #footer-authoring > a").removeClass("active"),n.Authoring.isActive?$("a:contains('edit exhibit')").addClass("active"):$("a:contains('edit exhibit')").removeClass("active"))}function y(){var t=$("#profile_username"),i=$("#profile_email"),r=$("profile_display_name"),u=$("profile_agreement");$("#editProfileForm").dialog({title:"edit profile",modal:!0,height:600,width:600,buttons:{"save and close":function(){n.Service.putProfile(t,i)}},close:function(){n.Authoring.isActive=!1}})}function p(){$("#loginForm").dialog({title:"login",modal:!0,height:600,width:600,close:function(){n.Authoring.isActive=!1}})}function w(){n.Layout.animatingElements.length==0&&(n.Authoring.isActive=n.Authoring.mode!=="editProfile"||!n.Authoring.isActive,n.Authoring.mode="editProfile",n.Authoring.showEditProfileForm())}function b(){n.Layout.animatingElements.length==0&&(n.Authoring.isActive=n.Authoring.mode!=="login"||!n.Authoring.isActive,n.Authoring.mode="login",n.Authoring.showLoginForm())}t.showCreateTimelineForm=f,t.showEditTimelineForm=e,t.showCreateExhibitForm=o,t.showEditExhibitForm=s,t.showEditContentItemForm=h,t.createTimeline=c,t.editTimeline=l,t.createExhibit=a,t.editExhibit=v,t.showEditProfileForm=y,t.showLoginForm=p,t.editProfile=w,t.login=b})(t.UI||(t.UI={}));var i=t.UI})(n.Authoring||(n.Authoring={}));var t=n.Authoring})(CZ||(CZ={}))